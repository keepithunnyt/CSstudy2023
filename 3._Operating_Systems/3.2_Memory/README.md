# 3.2 Memory

- [3.2.1 메모리 계층](#321-메모리-계층)
  - [캐시 (cache)](#캐시-cache)
  - [캐시 히트와 캐시 미스](#캐시-히트와-캐시-미스)


<br/>

---

# 3.2.1 메모리 계층
- 레지스터, 캐시, 메모리, 저장장치로 구성. 계층이 위로 올라갈수록 가격이 비싸고, 용량은 작아지고, 속도는 빨라진다. (RAM 16GB와 SSD 16GB)
  - **레지스터** : CPU 안의 작은 메모리. 휘발성이며 속도가 가장 빠르고 용량이 가장 적음
 - **캐시** : L1, L2 (요즘은 L3도 있음) 캐시를 지칭. 휘발성, 속도 빠름, 기억용량이 적음.
 - **주 기억장치** : RAM을 가리킴. 휘발성, 보통 속도, 보통의 용량
   - 하드디스크로부터 일정량의 데이터를 복사해 임시저장함. 필요시 CPU에 빠르게 전달한다.
 - **보조 기억장치** : HDD, SSD를 일컬음. 비휘발성, 속도 낮음, 용량이 많음.
-

## 캐시 (cache)
- 미리 복사해놓는 임시 저장소, 속도가 다른 장치 간 병목현상을 줄이기 위한 메모리.
- 계층과 계층 사이에 있는 계층을 캐싱 계층이라고 함.

### 지역성의 원리
- 캐시 계층을 두지 않고 직접 캐시 설정을 하려면 자주 사용하는 데이터 기반으로 설정한다.
- **지역성** : 자주 사용하는 데이터의 근거. 시간 지역성(temporal locality)과 공간 지역성(spatial) locality)으로 나뉜다.
  - **시간 지역성** : 최근에 사용한 데이터에 다시 접근하려는 특성
  - **공간 지역성** : 최근 접근한 데이터를 이루고 있는 공간이나, 그것과 가까운 공간에 접근하려는 특성

## 캐시 히트와 캐시 미스
 - 캐시 히트 : 제어장치가 캐시에서 원하는 데이터를 찾음
   - CPU 내부 서브 기반으로 동작하여 빠름.
 - 캐시 미스 : 해당 데이터가 캐시에 없어서 주 메모리로 가서 데이터를 찾아옴.
   - 시스템 버스 기반이라 느림

### 캐시 매핑
- 캐시가 히트되기 위해 매핑하는 방법. CPU의 레지스터와 RAM(주메모리) 간 데이터 송수신을 기반으로 설명됨.

|이름|설명|
|---|---|
|직접 매핑(directed mapping)|메모리가 1~100 이고 캐시가 1~10이면 1:1~10, 2:1~20 으로 매핑하는 것.<br/> 속도 빠름. 충돌 잦음.|
|연관 매핑(associative mapping)|순서X. 관련있는 캐시와 메모리를 매핑함.<br/> 속도 느림. 충돌 적음.|
|집합 연관 매핑(set associative mapping)|직접 매핑과 연관 매핑을 합친 방법. 순서는 일치하지만 집합을 둬서 블록화되어 있어서 검색 효율이 좋다.<br/> 메모리가 1~100 이고 캐시가 1~10이면 캐시 1~5에 1~50의 데이터를 무작위로 저장.|

### 웹 브라우저의 캐시 매핑
- 쿠키, 로컬 스토리지, 세션 스토리지 등이 있음.
- 사용자 커스텀 정보나 인증 모듈 사항을 웹 브라우저에 저장해서, 추후 서버에 요청할 때 중복 요청 방지에 쓰임.

|쿠키|로컬 스토리지|세션 스토리지|
|------|---|---|
|- 만료기한이 있는 key-value 저장소<br/> - same site 옵션을 strict로 설정하지 않으면 다른 도메인에서 요청 시 자동 전송됨.<br/> - 4KB까지 데이터 저장 가능. 만료기한을 정할 수 있음(보통 서버에서 정한다.)<br/> -  document.cookie로 쿠키를 볼 수 없게 httponly 옵션을 거는 것이 중요하다.|- 만료기한이 없는 key-value 저장소<br/> - 10MB까지 저장<br/>  - 웹 브라우저를 닫아도 유지됨<br/>  - 도메인 단위로 저장, 생성됨<br/>  - HTML5를 지원하지 않는 웹 브라우저에서 사용X<br/>  - 클라에서만 수정가능| - 만료기한이 없는 key-value 저장소<br/> - 탭 단위로 세션 스토리지 생성<br/> - 5MB까지 저장<br/> - HTML5를 지원하지 않는 웹 브라우저에서 사용X<br/>  - 클라에서만 수정가능|

### 데이터베이스의 캐싱 계층
- 레디스(redis) 데이터베이스를 캐싱 계층으로 두고 성능을 향상시키기도 한다.
  - [레디스 --> 앱] 캐시 히트 : 레디스로부터 데이터를 읽는다.
  - [앱 --> 레디스] 데이터를 레디스에 씀.
  - [메인 DB --> 앱] 캐시 미스 : 메인 데이터베이스로부터 데이터를 가져옴




